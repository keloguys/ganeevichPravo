const questionsDataExpanded = {
    "1": {
     question: "Понятие и виды социальных норм?",
     answers: [
     "Социальные нормы — это правила поведения, установленные государством.",
     "Социальные нормы — это общие правила и образцы поведения, обусловленные общественными отношениями.",
     "Социальные нормы — это только правила морали.",
     "Социальные нормы — это только религиозные предписания."
     ],
     correct: 1 // Correct
    },
    "2": {
     question: "Какие виды правовых норм есть?",
     answers: [
     "Обязывающие, запрещающие, управомачивающие",
     "Только обязывающие",
     "Только запрещающие",
     "Только управомачивающие"
     ],
     correct: 0 // Correct
    },
    "3": {
     question: "Что такое нормативно-правовой акт?",
     answers: [
     "Любой документ, изданный государственным органом.",
     "Документ, содержащий правила поведения, обязательные для адресатов.",
     "Только закон, принятый парламентом.",
     "Только подзаконный акт, изданный правительством."
     ],
     correct: 1 // Correct
    },
    "4": {
     question: "Какова структура правоотношения?",
     answers: [
     "Субъект, объект, содержание",
     "Только субъект и объект",
     "Только объект и содержание",
     "Только субъект и содержание"
     ],
     correct: 0 // Correct
    },
    "5": {
     question: "Что такое правонарушение?",
     answers: [
     "Любое неправомерное действие.",
     "Общественно опасное виновное поведение, противоречащее нормам права.",
     "Только преступление.",
     "Только проступок."
     ],
     correct: 1 // Correct
    },
    "6": {
     question: "Виды юридической ответственности?",
     answers: [
      "Уголовная, административная, гражданская, дисциплинарная, материальная",
      "Только уголовная и административная",
      "Только гражданская и дисциплинарная",
      "Только материальная"
     ],
     correct: 0 // Correct
    },
    "7": {
     question: "Место Конституции в системе законодательства?",
     answers: [
     "Основной закон государства, высшая юридическая сила.",
     "Обычный закон, как и другие.",
     "Не имеет особого значения.",
     "Только рекомендательный документ."
     ],
     correct: 0 // Correct
    },
    "8": {
     question: "Признаки предпринимательской деятельности?",
     answers: [
     "Самостоятельность, инициатива, риск, прибыль",
     "Только самостоятельность и прибыль",
     "Только инициатива и риск",
     "Только прибыль"
     ],
     correct: 0 // Correct
    },
    "9": {
      question: "Отрасли права, регулирующие хозяйственные отношения в РФ?",
      answers: [
       "Гражданское право, административное право, трудовое право и др.",
       "Только гражданское право",
       "Только административное право",
       "Только трудовое право"
      ],
      correct: 0 // Correct
      },
    "10": {
      question: "Признаки субъектов предпринимательской деятельности?",
      answers: [
       "Регистрация, хозяйственная компетенция, обособленное имущество, самостоятельная ответственность",
       "Только регистрация",
       "Только хозяйственная компетенция",
       "Только обособленное имущество"
      ],
      correct: 0 // Correct
      },
      "11": {
        question: "В чем основное различие между преступлением и проступком в российском праве?",
        answers: [
          "Преступления — более тяжкие деяния, караются более строгими наказаниями (лишение свободы, крупный штраф), проступки — менее тяжкие, наказываются более мягкими мерами (штраф, административный арест).",
          "Преступления и проступки — это синонимы, различий нет.",
          "Преступления всегда связаны с причинением значительного материального ущерба, а проступки — нет.",
          "Проступки — это только административные правонарушения, преступления — только уголовные."
        ],
        correct: 0 
      },
    "12": {
      question: "Какие виды договоров регулируются гражданским правом?",
      answers: [
       "Купля-продажа, аренда, подряда, займа и многие другие.",
       "Только договоры купли-продажи.",
       "Только договоры аренды.",
       "Только договоры займа."
      ],
      correct: 0 // Correct
      },
    "13": {
      question: "Что такое субъективное право?",
      answers: [
       "Возможность лица осуществлять действия, гарантированные ему правом.",
       "Норма права, содержащаяся в законе.",
       "Юридическое лицо.",
       "Правосудие."
      ],
      correct: 0 // Correct
      },
    "14": {
      question: "Какие органы осуществляют правосудие в РФ?",
      answers: [
       "Суды общей юрисдикции, арбитражные суды, Конституционный суд РФ.",
       "Только суды общей юрисдикции.",
       "Только арбитражные суды.",
       "Только Конституционный суд РФ."
      ],
      correct: 0 // Correct
      },
    "15": {
      question: "В чем заключается принцип законности?",
      answers: [
       "Строгое соблюдение всеми субъектами права законов и других нормативных актов.",
       "Возможность изменить закон по своему усмотрению.",
       "Нарушение закона допускается в исключительных случаях.",
       "Закон не имеет обязательной силы."
      ],
      correct: 0 // Correct
      },
    "16": {
      question: "Какие источники права существуют в РФ?",
      answers: [
       "Конституция, законы, подзаконные акты, судебные прецеденты, обычаи.",
       "Только Конституция РФ.",
       "Только законы РФ.",
       "Только подзаконные акты."
      ],
      correct: 0 // Correct
      },
    "17": {
      question: "Что такое юридическая ответственность?",
      answers: [
       "Меры государственного принуждения за совершенное правонарушение.",
       "Любые неблагоприятные последствия.",
       "Только уголовное наказание.",
       "Только административный штраф."
      ],
      correct: 0 // Correct
      },
    "18": {
      question: "Что такое правоспособность?",
      answers: [
        "Способность иметь гражданские права и нести обязанности.",
        "Способность своими действиями приобретать и осуществлять гражданские права и обязанности.",
        "Только право владения имуществом.",
        "Только право на заключение договоров."
      ],
      correct: 0
    },
    "19": {
      question: "Что такое деликтоспособность?",
      answers: [
        "Способность лица нести юридическую ответственность за свои противоправные действия.",
        "Способность совершать сделки.",
        "Способность иметь имущество.",
        "Способность избирать и быть избранным."
      ],
      correct: 0
    },
    "20": {
      question: "Какие виды сделок существуют в гражданском праве?",
      answers: [
        "Односторонние, двухсторонние, многосторонние.",
        "Только односторонние.",
        "Только двухсторонние.",
        "Только многосторонние."
      ],
      correct: 0
    }
  };
  
  const startButton = document.getElementById('start-test');
  const testContainer = document.getElementById('test-container');
  const resultsContainer = document.getElementById('results-container');
  const questionsDiv = document.getElementById('questions');
  const userNameInput = document.getElementById('userName');
  const difficultySelect = document.getElementById('difficulty');
  const submitButton = document.getElementById('submit-test');
  const retryButton = document.getElementById('retry-test');
  const goBackButton = document.getElementById('go-back');
  const detailedResultsDiv = document.getElementById('detailed-results');
  
  startButton.addEventListener('click', startTest);
  submitButton.addEventListener('click', submitTest);
  retryButton.addEventListener('click', resetTest);
  goBackButton.addEventListener('click', resetTest);
  
  function resetTest() {
      resultsContainer.style.display = 'none';
      testContainer.style.display = 'none';
      document.getElementById('name-input').style.display = 'block';
      document.getElementById('difficulty-select').style.display = 'block';
      document.getElementById('start-test').style.display = 'block';
      detailedResultsDiv.innerHTML = ''; // Clear detailed results
  }
  
  
  function startTest() {
      document.getElementById('name-input').style.display = 'none';
      document.getElementById('difficulty-select').style.display = 'none';
      document.getElementById('start-test').style.display = 'none';
      testContainer.style.display = 'block';
      let numQuestions = 0;
      if(difficultySelect.value === 'easy') numQuestions = 5;
      if(difficultySelect.value === 'medium') numQuestions = 7;
      if(difficultySelect.value === 'hard') numQuestions = Object.keys(questionsDataExpanded).length;
  
      const selectedQuestions = getRandomQuestions(numQuestions);
      generateQuestions(selectedQuestions);
  }
  
  function getRandomQuestions(numQuestions) {
    const keys = Object.keys(questionsDataExpanded);
    // Создаем копию ключей, чтобы не менять исходный массив
    const shuffledKeys = [...keys];
  
    // Перемешиваем массив с помощью алгоритма Фишера-Йетса
    for (let i = shuffledKeys.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffledKeys[i], shuffledKeys[j]] = [shuffledKeys[j], shuffledKeys[i]];
    }
  
    return shuffledKeys.slice(0, numQuestions);
  }
  
  
  function generateQuestions(questions) {
      questionsDiv.innerHTML = '';
      questions.forEach(questionId => {
          const questionData = questionsDataExpanded[questionId];
          const questionHTML = `
              <div class="question">
                <h3>${questionData.question}</h3>
                <ul>
                ${questionData.answers.map((answer, index) => `<li><input type="radio" name="${questionId}" value="${index}"> ${answer}</li>`).join('')}
              </ul>
            </div>
          `;
        questionsDiv.innerHTML += questionHTML;
    });
}

function submitTest() {
    testContainer.style.display = 'none';
    resultsContainer.style.display = 'block';
    let correctAnswers = 0;
    let answeredQuestions = 0; // Количество отвеченных вопросов
    const answers = {};
    const totalQuestions = Object.keys(questionsDataExpanded).length;

    for (let i = 1; i <= totalQuestions; i++) {
        const radios = document.querySelectorAll(`input[name="${i}"]:checked`);
        if (radios.length > 0) {
            answers[i] = parseInt(radios[0].value);
            answeredQuestions++; // Увеличиваем счетчик отвеченных вопросов
        } else {
            answers[i] = -1; // Отсутствует ответ
        }
    }

    for (const key in answers) {
        if (answers[key] === questionsDataExpanded[key].correct) {
            correctAnswers++;
        }
    }

    // Подсчет баллов (1 балл за каждый верный ответ)
    const totalScore = correctAnswers;
    const grade = calculateGrade(answeredQuestions, correctAnswers);


    document.getElementById('score').innerText = "Баллы: " + totalScore + " из " + answeredQuestions;
    document.getElementById('grade').innerText = "Оценка: " + grade;
    generateDetailedResults(answers);
}


function calculateGrade(answeredQuestions, correctAnswers) {
    if (answeredQuestions === 0) return 2; // Если ни на один вопрос не ответили - оценка 2

    const percentage = (correctAnswers / answeredQuestions) * 100;

    if (percentage >= 90) return 5;
    if (percentage >= 80) return 4;
    if (percentage >= 70) return 3;
    return 2; // Менее 70% правильных ответов
}

function generateDetailedResults(answers) {
    detailedResultsDiv.innerHTML = '<ul>';
    for (const key in answers) {
        const questionData = questionsDataExpanded[key];
        const userAnswer = answers[key] !== -1 ? questionData.answers[answers[key]] : 'Ответ отсутствует';
        const correctAnswer = questionData.answers[questionData.correct];
        const isCorrect = answers[key] === questionData.correct;

        detailedResultsDiv.innerHTML += `<li><b>Вопрос ${key}:</b> ${questionData.question}
            <br>Ваш ответ: ${userAnswer}
            <br>Верный ответ: ${correctAnswer}
            <br>Результат: ${isCorrect ? 'Верно' : 'Неверно'}
        </li>`;
    }
    detailedResultsDiv.innerHTML += '</ul>';
}
function generateDetailedResults(answers) {
    const detailedResults = document.getElementById('detailed-results');
    detailedResults.innerHTML = '';

    const ul = document.createElement('ul');
    detailedResults.appendChild(ul);

    for (const key in answers) {
        const questionData = questionsDataExpanded[key];
        const userAnswer = answers[key] !== -1 ? questionData.answers[answers[key]] : 'Ответ отсутствует';
        const correctAnswer = questionData.answers[questionData.correct];
        const isCorrect = answers[key] === questionData.correct;

        const li = document.createElement('li');
        ul.appendChild(li);

        const questionDiv = document.createElement('div');
        questionDiv.classList.add('question');
        questionDiv.innerText = `Вопрос ${key}: ${questionData.question}`;
        li.appendChild(questionDiv);

        const answerDiv = document.createElement('div');
        answerDiv.classList.add('answer');
        answerDiv.innerHTML = `
            <p>Ваш ответ: ${userAnswer}</p>
            <p>Верный ответ: ${correctAnswer}</p>
            <p>Результат: ${isCorrect ? 'Верно' : 'Неверно'}</p>
        `;
        li.appendChild(answerDiv);
    }
}
  